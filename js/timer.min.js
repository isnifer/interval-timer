!function(){function t(t){this.name=t.name||"Press",this.program=t.program?t.program:{},this.constructor=constructor?constructor:t.constructor,this.date=function(){var e=new Date,r=["01","02","03","04","05","06","07","08","09","10","11","12"];return t.date?t.date:e.getDate()+"."+r[e.getMonth()]+"."+e.getFullYear()}()}function e(){var t=this.getAttribute("data-timer");m[t].load()}function r(t){if(t.target===this){var e=this.getAttribute("data-timer");m[e].load(),s.stop.setAttribute("data-timer",e),s.pause.setAttribute("data-timer",e),s.start.setAttribute("data-timer",e)}}function a(t,e){var a=document.createElement("li"),i=document.createElement("span");a.classList.add("timers__item"),i.classList.add("timers__remove"),a.setAttribute("data-timer",t),i.setAttribute("data-timer",t),a.textContent=e,i.textContent="Remove",a.appendChild(i),c.appendChild(a),a.addEventListener("click",r,!1),i.addEventListener("click",n,!1)}function n(t){if(t.target===this){var e=this.getAttribute("data-timer"),r=JSON.parse(localStorage.timers);r.splice(e,1),localStorage.setItem("timers",JSON.stringify(r)),m.splice(e,1),this.parentNode.remove()}}var i={createNewTimer:document.querySelector(".controls__view-form"),create:document.querySelector(".controls__create"),addWork:document.querySelector(".partials__add"),save:document.querySelector(".partials__save"),createNew:document.querySelector(".partials__create-new"),load:document.querySelector(".partials__load"),saveLocal:document.querySelector(".partials__local")},o={el:document.querySelector(".controls__form"),partials:document.querySelector(".partials"),partialsForm:document.querySelector(".partials__content"),welcomeBlock:document.querySelector(".controls__name-block")},s={el:document.querySelector(".current"),header:document.querySelector(".current__header"),actionTitle:document.querySelector(".current__action-title"),actionTime:document.querySelector(".current__action-time"),elapsed:document.querySelector(".current__elapsed-time"),remaining:document.querySelector(".current__remaining-time"),circle:document.querySelector(".current__circles-this"),circles:document.querySelector(".current__circles-all"),start:document.querySelector(".current__start"),pause:document.querySelector(".current__pause"),stop:document.querySelector(".current__stop"),audio:document.querySelector(".current__audio")},c=document.querySelector(".timers__list"),l=1,u=1,m=[];t.prototype.add=function(){var t=function(t){var e=document.createElement(t.tag),r=0;for(r;r<t.classNames.length;r++)e.classList.add(t.classNames[r]);return t.name&&e.setAttribute("name",t.name+"_"+l),e.textContent=t.content?t.content:"","work"===t.name?l+=1:u+=1,e},e=function(e){var r=t({tag:"label",classNames:["partials__label"]}),a=t({tag:"span",classNames:["partials__name"],content:e+" (s)"}),n=t({tag:"input",classNames:["partials__input","partials__"+e],name:e});return r.appendChild(a),r.appendChild(n),r},r=e("work"),a=e("rest");o.partialsForm.appendChild(r),o.partialsForm.appendChild(a)},t.prototype.pushToDOM=function(t,e){a(e,t),i.load.setAttribute("data-timer",e),i.saveLocal.setAttribute("data-timer",e),s.stop.setAttribute("data-timer",e),s.start.setAttribute("data-timer",e)},t.prototype.getHumanReadableTime=function(t,e){var r=10>t?"0"+t:t,a=10>e?"0"+e:e;return r+":"+a},t.prototype.load=function(){var t=this.program.alltime,e=parseInt(t/60),r=t-60*e,a=this.program.workouts[0].value,n=parseInt(a/60),i=a-60*n;s.header.textContent=this.name,s.remaining.textContent=this.getHumanReadableTime(e,r),s.actionTitle.textContent=this.program.workouts[0].title,s.actionTime.textContent=this.getHumanReadableTime(n,i),s.circle.textContent=1,s.circles.textContent=this.program.circles},t.prototype.start=function(){var t=this,e=0,r=1,a=0,n=t.program.alltime,i=t.program.workouts,o=i[a].value,c=function(t,e){var r,a,n,i=e;this.pause=function(){window.clearInterval(r),i-=new Date-a},this.stop=function(){window.clearInterval(r),r=null,s.elapsed.textContent="00:00"},n=function(){a=new Date,r=window.setTimeout(function(){i=e,n(),t()},i)},this.resume=n,this.resume()};this.timer=new c(function(){var c=parseInt(e/60),l=e-60*parseInt(c),u=parseInt(n/60),m=n-60*parseInt(u),d=parseInt(o/60),p=o-60*parseInt(d);s.elapsed.textContent=t.getHumanReadableTime(c,l),s.remaining.textContent=t.getHumanReadableTime(u,m),s.actionTime.textContent=t.getHumanReadableTime(d,p),0!==n?(4===o?(s.audio.currentTime=0,s.audio.play()):0>=o&&(i[a+1]?a+=1:r<t.program.circles&&(r+=1,a=0,s.circle.textContent=r),o=i[a].value,s.actionTitle.textContent=i[a].title),e+=1,n-=1,o-=1):t.timer.stop()},1e3)},i.create.addEventListener("click",function(t){t.preventDefault(),o.welcomeBlock.classList.add("controls_hidden"),o.partials.classList.add("partials_visible");var e=document.querySelector(".partials__timer-user-name");e.textContent=document.querySelector('input[name="timer-name"]').value},!1),i.save.addEventListener("click",function(){var e=document.getElementsByClassName("partials__work"),r=document.getElementsByClassName("partials__rest"),a=new t({name:document.querySelector('input[name="timer-name"]').value});a.program={circles:parseInt(document.querySelector(".partials__circle").value),workouts:[],alltime:""};for(var n=0;n<e.length;n++)a.program.workouts.push({title:"work",value:parseInt(e[n].value)}),a.program.workouts.push({title:"rest",value:parseInt(r[n].value)});a.program.alltime=function(){var t=a.program.workouts,e=t.length,r=0,n=0;for(n;e>n;n++)r+=t[n].value;return r*a.program.circles}(),m.push(a),a.pushToDOM(a.name,m.length-1),i.load.disabled=!1,localStorage&&(i.saveLocal.disabled=!1)},!1),i.addWork.addEventListener("click",function(e){e.preventDefault(),t.prototype.add()},!1),s.start.addEventListener("click",function(){var t=this.getAttribute("data-timer");m[t].start()},!1),s.pause.addEventListener("click",function(){var t=this.getAttribute("data-timer");"true"!==this.getAttribute("data-pause")?(m[t].timer.pause(),this.setAttribute("data-pause","true"),this.textContent="Возобновить"):(m[t].timer.resume(),this.setAttribute("data-pause","false"),this.textContent="Пауза")},!1),s.stop.addEventListener("click",function(){var t=this.getAttribute("data-timer");m[t].timer.stop()},!1),i.load.addEventListener("click",e,!1),s.stop.addEventListener("click",e,!1),i.saveLocal.addEventListener("click",function(){var t,e=this.getAttribute("data-timer"),r={name:m[e].name,program:m[e].program},a=[];a.push(JSON.stringify(r)),localStorage.timers?(t=JSON.parse(localStorage.timers),t.push(JSON.stringify(r)),localStorage.setItem("timers",JSON.stringify(t))):localStorage.setItem("timers",JSON.stringify(a))},!1),i.createNewTimer.addEventListener("click",function(){o.el.classList.toggle("controls__form_state_hidden")},!1);!function(){if(localStorage.timers){var e=localStorage.timers,r=0;for(e=JSON.parse(e),r;r<e.length;r++){var n=JSON.parse(e[r]);m[m.length]=new t({name:n.name,program:n.program}),a(m.length-1,n.name)}}}()}();