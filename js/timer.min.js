!function(){function t(t){this.name=t.name||"Press",this.program=t.program?t.program:{},this.constructor=constructor?constructor:t.constructor,this.date=function(){var e=new Date,r=["01","02","03","04","05","06","07","08","09","10","11","12"];return t.date?t.date:e.getDate()+"."+r[e.getMonth()]+"."+e.getFullYear()}()}function e(){var t=this.getAttribute("data-timer");u[t].load()}function r(){var t=this.getAttribute("data-timer");u[t].load(),i.stop.setAttribute("data-timer",t),i.pause.setAttribute("data-timer",t),i.start.setAttribute("data-timer",t)}function a(t,e){var a=document.createElement("li"),n=document.createElement("span"),o=document.createElement("span");a.classList.add("timers__item"),n.setAttribute("data-timer",t),o.setAttribute("data-timer",t),n.classList.add("timers__name"),o.classList.add("timers__remove"),n.textContent=e,o.textContent="Remove",a.appendChild(n),a.appendChild(o),s.appendChild(a),n.addEventListener("click",r,!1)}var n={create:document.querySelector(".controls__create"),addWork:document.querySelector(".partials__add"),save:document.querySelector(".partials__save"),createNew:document.querySelector(".partials__create-new"),load:document.querySelector(".partials__load"),saveLocal:document.querySelector(".partials__local")},o={partials:document.querySelector(".partials"),partialsForm:document.querySelector(".partials__content"),welcomeBlock:document.querySelector(".controls__name-block")},i={el:document.querySelector(".current"),header:document.querySelector(".current__header"),actionTitle:document.querySelector(".current__action-title"),actionTime:document.querySelector(".current__action-time"),elapsed:document.querySelector(".current__elapsed-time"),remaining:document.querySelector(".current__remaining-time"),circle:document.querySelector(".current__circles-this"),circles:document.querySelector(".current__circles-all"),start:document.querySelector(".current__start"),pause:document.querySelector(".current__pause"),stop:document.querySelector(".current__stop"),audio:document.querySelector(".current__audio")},s=document.querySelector(".timers__list"),c=1,l=1,u=[];t.prototype.createLocalTimer=function(e){return new t({name:e.name,program:e.program,constructor:t})},t.prototype.add=function(){var t=function(t){var e=document.createElement(t.tag),r=0;for(r;r<t.classNames.length;r++)e.classList.add(t.classNames[c]);return t.name&&e.setAttribute("name",t.name+"_"+c),e.textContent=t.content?t.content:"","work"===t.name?c+=1:l+=1,e},e=function(e){var r=t({tag:"label",classNames:["partials__label"]}),a=t({tag:"span",classNames:["partials__name"],content:e+" (s)"}),n=t({tag:"input",classNames:["partials__input","partials__"+e],name:e});return r.appendChild(a),r.appendChild(n),r},r=e("work"),a=e("rest");o.partialsForm.appendChild(r),o.partialsForm.appendChild(a)},t.prototype.pushToDOM=function(t,e){a(e,t),n.load.setAttribute("data-timer",e),n.saveLocal.setAttribute("data-timer",e),i.stop.setAttribute("data-timer",e),i.start.setAttribute("data-timer",e)},t.prototype.getHumanReadableTime=function(t,e){var r=10>t?"0"+t:t,a=10>e?"0"+e:e;return r+":"+a},t.prototype.load=function(){var t=this.program.alltime,e=parseInt(t/60),r=t-60*parseInt(e),a=this.program.workouts[0].value,n=parseInt(a/60),o=a-60*n;i.header.textContent=this.name,i.remaining.textContent=this.getHumanReadableTime(e,r),i.actionTitle.textContent=this.program.workouts[0].title,i.actionTime.textContent=this.getHumanReadableTime(n,o),i.circle.textContent=1,i.circles.textContent=this.program.circles},t.prototype.start=function(){var t=this,e=0,r=1,a=0,n=t.program.alltime,o=t.program.workouts,s=o[a].value,c=function(t,e){var r,a,n,o=e;this.pause=function(){window.clearInterval(r),o-=new Date-a},this.stop=function(){window.clearInterval(r),r=null,i.elapsed.textContent="00:00"},n=function(){a=new Date,r=window.setTimeout(function(){o=e,n(),t()},o)},this.resume=n,this.resume()};this.timer=new c(function(){var c=parseInt(e/60),l=e-60*parseInt(c),u=parseInt(n/60),m=n-60*parseInt(u),d=parseInt(s/60),p=s-60*parseInt(d);i.elapsed.textContent=t.getHumanReadableTime(c,l),i.remaining.textContent=t.getHumanReadableTime(u,m),i.actionTime.textContent=t.getHumanReadableTime(d,p),s-=1,0!==n?(e+=1,n-=1,3===s?(i.audio.currentTime=0,i.audio.play()):0>=s&&(o[a+1]?a+=1:r<t.program.circles&&(r+=1,a=0,i.circle.textContent=r),s=o[a].value,i.actionTitle.textContent=o[a].title)):t.timer.stop()},1e3)},t.prototype.stop=function(t){t=null},n.create.addEventListener("click",function(t){t.preventDefault(),o.welcomeBlock.classList.add("controls_hidden"),o.partials.classList.add("partials_visible");var e=document.querySelector(".partials__timer-user-name");e.textContent=document.querySelector('input[name="timer-name"]').value},!1),n.save.addEventListener("click",function(){var e=document.getElementsByClassName("partials__work"),r=document.getElementsByClassName("partials__rest"),a=new t({name:document.querySelector('input[name="timer-name"]').value});a.program={circles:parseInt(document.querySelector(".partials__circle").value),workouts:[],alltime:""};for(var o=0;o<e.length;o++)a.program.workouts.push({title:"work",value:parseInt(e[o].value)}),a.program.workouts.push({title:"rest",value:parseInt(r[o].value)});a.program.alltime=function(){var t=a.program.workouts,e=t.length,r=0,n=0;for(n;e>n;n++)r+=t[n].value;return r*a.program.circles}(),u.push(a),a.pushToDOM(a.name,u.length-1),n.load.disabled=!1,localStorage&&(n.saveLocal.disabled=!1)},!1),n.addWork.addEventListener("click",function(e){e.preventDefault(),t.prototype.add()},!1),i.start.addEventListener("click",function(){var t=this.getAttribute("data-timer");u[t].start()},!1),i.pause.addEventListener("click",function(){var t=this.getAttribute("data-timer");"true"!==this.getAttribute("data-pause")?(u[t].timer.pause(),this.setAttribute("data-pause","true"),this.textContent="Возобновить"):(u[t].timer.resume(),this.setAttribute("data-pause","false"),this.textContent="Пауза")},!1),i.stop.addEventListener("click",function(){var t=this.getAttribute("data-timer");u[t].timer.stop()},!1),n.load.addEventListener("click",e,!1),i.stop.addEventListener("click",e,!1),n.saveLocal.addEventListener("click",function(){var t,e=this.getAttribute("data-timer"),r={name:u[e].name,program:u[e].program},a=[];a.push(JSON.stringify(r)),localStorage.timers?(t=JSON.parse(localStorage.timers),t.push(JSON.stringify(r)),localStorage.setItem("timers",JSON.stringify(t))):localStorage.setItem("timers",JSON.stringify(a))},!1);!function(){if(localStorage.timers){var e=localStorage.timers,r=0;for(e=JSON.parse(e),r;r<e.length;r++){var n=JSON.parse(e[r]);u[u.length]=t.prototype.createLocalTimer({name:n.name,program:n.program}),a(u.length-1,n.name)}}}()}();