!function(){function e(e){this.name=e.name||"Press",this.program=e.program?e.program:{},this.constructor=constructor?constructor:e.constructor,this.date=function(){var t=new Date,r=["01","02","03","04","05","06","07","08","09","10","11","12"];return e.date?e.date:t.getDate()+"."+r[t.getMonth()]+"."+t.getFullYear()}()}function t(){var e=this.getAttribute("id");e=e.substring(e.indexOf("_")+1),u[e].load()}function r(){var e=this.id.substring(this.id.indexOf("_")+1);u[e].load(),i.reset.setAttribute("id","reset-timer_"+e),i.start.setAttribute("id","start-timer_"+e)}function a(e,t){var a=document.createElement("li"),n=document.createElement("span");a.classList.add("timers__item"),a.setAttribute("id","timer_"+e),n.classList.add("timers__name"),n.textContent=t,a.appendChild(n),s.appendChild(a),a.addEventListener("click",r,!1)}var n={create:document.querySelector(".controls__create"),addWork:document.querySelector(".partials__add"),save:document.querySelector(".partials__save"),createNew:document.querySelector(".partials__create-new"),load:document.querySelector(".partials__load"),saveLocal:document.querySelector(".partials__local")},o={partials:document.querySelector(".partials"),partialsForm:document.querySelector(".partials__content"),welcomeBlock:document.querySelector(".controls__name-block")},i={el:document.querySelector(".current"),header:document.querySelector(".current__header"),actionTitle:document.querySelector(".current__action-title"),actionTime:document.querySelector(".current__action-time"),elapsed:document.querySelector(".current__elapsed-time"),remaining:document.querySelector(".current__remaining-time"),circle:document.querySelector(".current__circles-this"),circles:document.querySelector(".current__circles-all"),start:document.querySelector(".current__start"),pause:document.querySelector(".current__pause"),reset:document.querySelector(".current__reset"),audio:document.querySelector(".current__audio")},s=document.querySelector(".timers__list"),c=1,l=1,u=[];e.prototype.createLocalTimer=function(t){return new e({name:t.name,program:t.program,constructor:e})},e.prototype.add=function(){var e=function(e){var t=document.createElement(e.tag),r=0;for(r;r<e.classNames.length;r++)t.classList.add(e.classNames[c]);return e.name&&t.setAttribute("name",e.name+"_"+c),t.textContent=e.content?e.content:"","work"===e.name?c+=1:l+=1,t},t=function(t){var r=e({tag:"label",classNames:["partials__label"]}),a=e({tag:"span",classNames:["partials__name"],content:t+" (s)"}),n=e({tag:"input",classNames:["partials__input","partials__"+t],name:t});return r.appendChild(a),r.appendChild(n),r},r=t("work"),a=t("rest");o.partialsForm.appendChild(r),o.partialsForm.appendChild(a)},e.prototype.pushToDOM=function(e,t){a(t,e),n.load.setAttribute("id","view-timer_"+t),n.saveLocal.setAttribute("id","local-timer_"+t),i.reset.setAttribute("id","reset-timer_"+t),i.start.setAttribute("id","start-timer_"+t)},e.prototype.getHumanReadableTime=function(e,t){var r=10>e?"0"+e:e,a=10>t?"0"+t:t;return r+":"+a},e.prototype.load=function(){var e=this.program.alltime,t=parseInt(e/60),r=e-60*parseInt(t),a=this.program.workouts[0].value,n=parseInt(a/60),o=a-60*n;i.header.textContent=this.name,i.remaining.textContent=this.getHumanReadableTime(t,r),i.actionTitle.textContent=this.program.workouts[0].title,i.actionTime.textContent=this.getHumanReadableTime(n,o),i.circle.textContent=1,i.circles.textContent=this.program.circles},e.prototype.start=function(){var e=this,t=0,r=1,a=0,n=e.program.alltime,o=e.program.workouts,s=o[a].value,c=setInterval(function(){var l=parseInt(t/60),u=t-60*parseInt(l),m=parseInt(n/60),d=n-60*parseInt(m),p=parseInt(s/60),_=s-60*parseInt(p);i.elapsed.textContent=e.getHumanReadableTime(l,u),i.remaining.textContent=e.getHumanReadableTime(m,d),i.actionTime.textContent=e.getHumanReadableTime(p,_),s-=1,3===s?(i.audio.currentTime=0,i.audio.play()):0>=s&&(clearInterval(c),o[a+1]?s=o[a+1].value:r<e.program.circles&&(r+=1,a=0,i.circle.textContent=r,s=o[a]))},1e3),l=setInterval(function(){0!==n?(t+=1,n-=1):(clearInterval(l),l=null)},1e3);i.actionTitle.textContent=o[a].title},e.prototype.pause=function(){},e.prototype.reset=function(){},e.prototype.stop=function(e){e=null},n.create.addEventListener("click",function(e){e.preventDefault(),o.welcomeBlock.classList.add("controls_hidden"),o.partials.classList.add("partials_visible");var t=document.querySelector(".partials__timer-user-name");t.textContent=document.querySelector('input[name="timer-name"]').value},!1),n.save.addEventListener("click",function(){var t=document.getElementsByClassName("partials__work"),r=document.getElementsByClassName("partials__rest"),a=new e({name:document.querySelector('input[name="timer-name"]').value});a.program={circles:parseInt(document.querySelector(".partials__circle").value),workouts:[],alltime:""};for(var o=0;o<t.length;o++)a.program.workouts.push({title:"work",value:parseInt(t[o].value)}),a.program.workouts.push({title:"rest",value:parseInt(r[o].value)});a.program.alltime=function(){var e=a.program.workouts,t=e.length,r=0,n=0;for(n;t>n;n++)r+=e[n].value;return r*a.program.circles}(),u.push(a),a.pushToDOM(a.name,u.length-1),n.load.disabled=!1,localStorage&&(n.saveLocal.disabled=!1)},!1),n.addWork.addEventListener("click",function(t){t.preventDefault(),e.prototype.add()},!1),i.start.addEventListener("click",function(){var e=this.getAttribute("id");e=e.substring(e.indexOf("_")+1),u[e].start()},!1),n.load.addEventListener("click",t,!1),i.reset.addEventListener("click",t,!1),n.saveLocal.addEventListener("click",function(){var e,t=this.getAttribute("id"),r={name:u[t].name,program:u[t].program},a=[];t=t.substring(t.indexOf("_")+1),a.push(JSON.stringify(r)),localStorage.timers?(e=JSON.parse(localStorage.timers),e.push(JSON.stringify(r)),localStorage.setItem("timers",JSON.stringify(e))):localStorage.setItem("timers",JSON.stringify(a))},!1);!function(){if(localStorage.timers){var t=localStorage.timers,r=0;for(t=JSON.parse(t),r;r<t.length;r++){var n=JSON.parse(t[r]);u[u.length]=e.prototype.createLocalTimer({name:n.name,program:n.program}),a(u.length-1,n.name)}}}()}();