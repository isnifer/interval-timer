!function(){function e(e){this.name=e.name||"Press",this.program=e.program?e.program:{},this.constructor=constructor?constructor:e.constructor,this.date=function(){var t=new Date,r=["01","02","03","04","05","06","07","08","09","10","11","12"];return e.date?e.date:t.getDate()+"."+r[t.getMonth()]+"."+t.getFullYear()}()}function t(){var e=this.getAttribute("id");e=e.substring(e.indexOf("_")+1),l[e].load()}function r(){var e=this.id.substring(this.id.indexOf("_")+1);l[e].load(),o.reset.setAttribute("id","reset-timer_"+e),o.start.setAttribute("id","start-timer_"+e)}function n(e,t){var n=document.createElement("li"),a=document.createElement("span");n.classList.add("timers__item"),n.setAttribute("id","timer_"+e),a.classList.add("timers__name"),a.textContent=t,n.appendChild(a),i.appendChild(n),n.addEventListener("click",r,!1)}var a={create:document.querySelector(".controls__create"),addWork:document.querySelector(".partials__add"),save:document.querySelector(".partials__save"),createNew:document.querySelector(".partials__create-new"),load:document.querySelector(".partials__load"),saveLocal:document.querySelector(".partials__local")},o=({partials:document.querySelector(".partials"),partialsForm:document.querySelector(".partials__content"),welcomeBlock:document.querySelector(".controls__name-block")},{el:document.querySelector(".current"),header:document.querySelector(".current__header"),actionTitle:document.querySelector(".current__action-title"),time:document.querySelector(".current__time"),elapsed:document.querySelector(".current__elapsed-time"),remaining:document.querySelector(".current__remaining-time"),circle:document.querySelector(".current__circles-this"),circles:document.querySelector(".current__circles-all"),start:document.querySelector(".current__start"),pause:document.querySelector(".current__pause"),reset:document.querySelector(".current__reset"),audio:document.querySelector(".current__audio")}),i=document.querySelector(".timers__list"),c=1,s=1,l=[];e.prototype.createLocalTimer=function(t){return new e({name:t.name,program:t.program,constructor:e})},e.prototype.add=function(){var e=function(e){var t=document.createElement(e.tag),r=0;for(r;r<e.classNames.length;r++)t.classList.add(e.classNames[r]);return e.name&&t.setAttribute("name",e.name+"_"+c),e.content&&(t.textContent=e.content),"work"===e.name?c+=1:s+=1,t},t=function(t){var r=e({tag:"label",classNames:["partials__label"]}),n=e({tag:"span",classNames:["partials__name"],content:t+" (s)"}),a=e({tag:"input",classNames:["partials__input","partials__"+t],name:t});return r.appendChild(n),r.appendChild(a),r},r=t("work"),n=t("rest");partialsForm.appendChild(r),partialsForm.appendChild(n)},e.prototype.pushToDOM=function(e,t){n(t,e),a.load.setAttribute("id","view-timer_"+t),a.saveLocal.setAttribute("id","local-timer_"+t),o.reset.setAttribute("id","reset-timer_"+t),o.start.setAttribute("id","start-timer_"+t)},e.prototype.load=function(){var e=this;o.header.textContent=this.name,o.circles.textContent=this.program.circles,o.circle.textContent=1,o.actionTitle.textContent=this.program.workouts[0].title,o.time.textContent=function(){var t=e.program.workouts[0].value,r=parseInt(t/60),n=function(){var e=t-60*parseInt(t/60);return 10>e?"0"+e:e}();return 3600>t&&t>=600?r+":"+n:600>t&&t>=60?"0"+r+":"+n:60>t&&t>=10?"00:"+t:"00:0"+t}(),o.remaining.textContent=function(){var t=e.program.alltime,r=function(){var e=parseInt(t/60);return 10>e?"0"+e:e}(),n=function(){var e=t-60*parseInt(r);return 10>e?"0"+e:e}();return r+":"+n}()},e.prototype.start=function(e,t){var r=this,n=t?t:1,a=e?e:0,i=r.program.workouts,c=i[a].value,s=setInterval(function(){o.time.textContent=function(){var e=function(){var e=parseInt(c/60);return 10>e?"0"+e:e}(),t=function(){var t=c-60*parseInt(e);return 10>t?"0"+t:t}();return e+":"+t}(),c-=1,3===c?(o.audio.currentTime=0,o.audio.play()):0>=c&&(clearInterval(s),i[a+1]?(console.log("Action change"),r.start(a+1,n)):n<r.program.circles?(console.log("Circle change"),r.changeCircle(n+1)):(console.log("Timer stop"),r.stop(s)))},1e3);o.actionTitle.textContent=i[a].title},e.prototype.changeCircle=function(e){o.circle.textContent=e,this.start(0,e)},e.prototype.pause=function(){},e.prototype.reset=function(){},e.prototype.stop=function(e){e=null},e.prototype.changeElapsed=function(){var e=0,t=this,r=(t.program.alltime,setInterval(function(){var n=function(){var t=parseInt(e/60);return 10>t?"0"+t:t}(),a=function(){var t=e-60*parseInt(n);return 10>t?"0"+t:t}();o.elapsed.textContent=n+":"+a,e<t.program.alltime?e+=1:(clearInterval(r),r=null)},1e3))},e.prototype.changeRemaining=function(){var e=this,t=e.program.alltime,r=setInterval(function(){var e=function(){var e=parseInt(t/60);return 10>e?"0"+e:e}(),n=function(){var r=t-60*parseInt(e);return 10>r?"0"+r:r}();o.remaining.textContent=e+":"+n,0!==t?t-=1:(clearInterval(r),r=null)},1e3)},timerActions.create.addEventListener("click",function(e){e.preventDefault(),welcomeBlock.classList.add("controls_hidden"),partials.classList.add("partials_visible");var t=document.querySelector(".partials__timer-user-name");t.textContent=document.querySelector('input[name="timer-name"]').value},!1),timerActions.save.addEventListener("click",function(){var t=new e({name:document.querySelector('input[name="timer-name"]').value});t.program={circles:parseInt(document.querySelector(".partials__circle").value),workouts:[],alltime:""};for(var r=document.getElementsByClassName("partials__work"),n=document.getElementsByClassName("partials__rest"),a=0;a<r.length;a++)t.program.workouts.push({title:"work",value:parseInt(r[a].value)}),t.program.workouts.push({title:"rest",value:parseInt(n[a].value)});t.program.alltime=function(){for(var e=t.program.workouts,r=e.length,n=0,a=0;r>a;a++)n+=e[a].value;return n*t.program.circles}(),l.push(t),console.log(l),t.pushToDOM(t.name,l.length-1),view.disabled=!1,localStorage&&(local.disabled=!1)},!1),addWork.addEventListener("click",function(t){t.preventDefault(),e.prototype.add()},!1),o.start.addEventListener("click",function(){var e=this.getAttribute("id");e=e.substring(e.indexOf("_")+1),l[e].start(),l[e].changeElapsed(),l[e].changeRemaining()},!1),view.addEventListener("click",t,!1),o.reset.addEventListener("click",t,!1),local.addEventListener("click",function(){var e=this.getAttribute("id");e=e.substring(e.indexOf("_")+1);var t,r={name:l[e].name,program:l[e].program},n=[];n.push(JSON.stringify(r)),localStorage.timers?(t=JSON.parse(localStorage.timers),t.push(JSON.stringify(r)),localStorage.setItem("timers",JSON.stringify(t)),console.log("Success Resave")):(localStorage.setItem("timers",JSON.stringify(n)),console.log("Success save")),console.log(localStorage.timers)},!1);!function(){if(localStorage.timers){var t=localStorage.timers,r=0;for(t=JSON.parse(t),r;r<t.length;r++){var a=JSON.parse(t[r]);l[l.length]=e.prototype.createLocalTimer({name:a.name,program:a.program}),n(l.length-1,a.name)}}}()}();