!function(e,t,r){function a(e){this.name=e&&e.name?e.name:"Press",this.program=e&&e.program?e.program:{},this.date=function(){var t=new Date,r=["01","02","03","04","05","06","07","08","09","10","11","12"];return e&&e.date?e.date:t.getDate()+"."+r[t.getMonth()]+"."+t.getFullYear()}()}function n(t,r){var a,n,i,s=r;this.pause=function(){e.clearInterval(a),s-=new Date-n},this.stop=function(){e.clearInterval(a),a=null,f.elapsed.textContent="00:00"},i=function(){n=new Date,a=e.setTimeout(function(){s=r,i(),t()},s)},this.resume=i,this.resume()}function i(){h.welcomeBlock.classList.add("controls_hidden"),h.partials.classList.add("partials_visible");var e=t.querySelector(".partials__timer-user-name");e.textContent=t.querySelector('input[name="timer-name"]').value}function s(){var e=t.getElementsByClassName("partials__work"),n=t.getElementsByClassName("partials__rest"),i=new a({name:t.querySelector('input[name="timer-name"]').value});i.program={circles:parseInt(t.querySelector(".partials__circle").value),workouts:[],alltime:""};for(var s=0;s<e.length;s++)i.program.workouts.push({title:"work",value:parseInt(e[s].value)}),i.program.workouts.push({title:"rest",value:parseInt(n[s].value)});i.program.alltime=function(){var e=i.program.workouts,t=e.length,r=0,a=0;for(a;t>a;a++)r+=e[a].value;return r*i.program.circles}(),w.push(i),i.pushToDOM(i.name,w.length-1),v.load.disabled=!1,v.saveLocal.disabled=!r}function o(){w[T.currentTimer].start(),k(!0)}function l(){T.onPause?(w[T.currentTimer].timer.resume(),this.textContent="Пауза"):(w[T.currentTimer].timer.pause(),this.textContent="Возобновить"),T.onPause=!T.onPause}function c(){h.el.classList.toggle("controls__form_state_hidden")}function u(){w[T.currentTimer].timer.stop(),w[T.currentTimer].load(),k(!1),f.pause.textContent="Пауза"}function m(){var e,t={name:w[T.currentTimer].name,program:w[T.currentTimer].program},a=[];a.push(JSON.stringify(t)),r.timers?(e=JSON.parse(r.timers),e.push(JSON.stringify(t)),r.setItem("timers",JSON.stringify(e))):r.setItem("timers",JSON.stringify(a))}function p(e){T.currentTimer&&w[T.currentTimer].timer&&w[T.currentTimer].timer.stop();var t=e.target.getAttribute("data-timer");w[t].load(),T.currentTimer=t,k(!1)}function d(e){e.target===this&&p(e)}function _(e,r){var a=t.createElement("li"),n=t.createElement("span");a.classList.add("timers__item"),n.classList.add("timers__remove"),a.setAttribute("data-timer",e),n.setAttribute("data-timer",e),a.textContent=r,n.textContent="Remove",a.appendChild(n),y.appendChild(a),a.addEventListener("click",d,!1),n.addEventListener("click",g,!1)}function g(e){if(e.target===this){var t=this.getAttribute("data-timer"),a=JSON.parse(r.timers);a.splice(t,1),r.setItem("timers",JSON.stringify(a)),w.splice(t,1),this.parentNode.remove()}}var v={chooseName:t.querySelector(".controls__view-form"),fillFields:t.querySelector(".controls__create"),addWork:t.querySelector(".partials__add"),save:t.querySelector(".partials__save"),createNew:t.querySelector(".partials__create-new"),load:t.querySelector(".partials__load"),saveLocal:t.querySelector(".partials__local")},h={el:t.querySelector(".controls__form"),partials:t.querySelector(".partials"),partialsForm:t.querySelector(".partials__content"),welcomeBlock:t.querySelector(".controls__name-block")},f={el:t.querySelector(".current"),header:t.querySelector(".current__header"),actionTitle:t.querySelector(".current__action-title"),actionTime:t.querySelector(".current__action-time"),elapsed:t.querySelector(".current__elapsed-time"),remaining:t.querySelector(".current__remaining-time"),circle:t.querySelector(".current__circles-this"),circles:t.querySelector(".current__circles-all"),start:t.querySelector(".current__start"),pause:t.querySelector(".current__pause"),stop:t.querySelector(".current__stop"),audio:t.querySelector(".current__audio")},y=t.querySelector(".timers__list"),S=1,q=1,w=[],T={currentTimer:0,onPause:!1},k=function(e){f.start.disabled=e,f.pause.disabled=f.stop.disabled=!e};a.prototype.add=function(){var e=function(e){var r=t.createElement(e.tag),a=0;for(a;a<e.classNames.length;a++)r.classList.add(e.classNames[a]);return e.name&&r.setAttribute("name",e.name+"_"+S),r.textContent=e.content?e.content:"","work"===e.name?S+=1:q+=1,r},r=function(t){var r=e({tag:"label",classNames:["partials__label"]}),a=e({tag:"span",classNames:["partials__name"],content:t+" (s)"}),n=e({tag:"input",classNames:["partials__input","partials__"+t],name:t});return r.appendChild(a),r.appendChild(n),r},a=r("work"),n=r("rest");h.partialsForm.appendChild(a),h.partialsForm.appendChild(n)},a.prototype.pushToDOM=function(e,t){_(t,e),v.load.setAttribute("data-timer",t),v.saveLocal.setAttribute("data-timer",t)},a.prototype.getHumanReadableTime=function(e,t){var r=10>e?"0"+e:e,a=10>t?"0"+t:t;return r+":"+a},a.prototype.load=function(){var e=this.program.alltime,t=parseInt(e/60),r=e-60*t,a=this.program.workouts[0].value,n=parseInt(a/60),i=a-60*n;f.header.textContent=this.name,f.remaining.textContent=this.getHumanReadableTime(t,r),f.actionTitle.textContent=this.program.workouts[0].title,f.actionTime.textContent=this.getHumanReadableTime(n,i),f.circle.textContent=1,f.circles.textContent=this.program.circles},a.prototype.start=function(){var e=this,t=0,r=1,a=0,i=e.program.alltime,s=e.program.workouts,o=s[a].value;this.timer=new n(function(){var n=parseInt(t/60),l=t-60*parseInt(n),c=parseInt(i/60),u=i-60*parseInt(c),m=parseInt(o/60),p=o-60*parseInt(m);f.elapsed.textContent=e.getHumanReadableTime(n,l),f.remaining.textContent=e.getHumanReadableTime(c,u),f.actionTime.textContent=e.getHumanReadableTime(m,p),0!==i?(4===o?(f.audio.currentTime=0,f.audio.play()):0>=o&&(s[a+1]?a+=1:r<e.program.circles&&(r+=1,a=0,f.circle.textContent=r),o=s[a].value,f.actionTitle.textContent=s[a].title),t+=1,i-=1,o-=1):e.timer.stop()},1e3,f)},v.fillFields.addEventListener("click",i,!1),v.save.addEventListener("click",s,!1),v.addWork.addEventListener("click",a.prototype.add,!1),f.start.addEventListener("click",o,!1),f.pause.addEventListener("click",l,!1),f.stop.addEventListener("click",u,!1),v.load.addEventListener("click",p,!1),v.saveLocal.addEventListener("click",m,!1),v.chooseName.addEventListener("click",c,!1);!function(){if(r&&r.timers){var e=r.timers,t=0;for(e=JSON.parse(e),t;t<e.length;t++){var n=JSON.parse(e[t]);w[w.length]=new a({name:n.name,program:n.program}),_(w.length-1,n.name)}}}()}(window,window.document,window.localStorage);