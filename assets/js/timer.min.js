!function(t,e,r){function a(t){this.name=t.name||"Press",this.program=t.program?t.program:{},this.constructor=constructor?constructor:t.constructor,this.date=function(){var e=new Date,r=["01","02","03","04","05","06","07","08","09","10","11","12"];return t.date?t.date:e.getDate()+"."+r[e.getMonth()]+"."+e.getFullYear()}()}function i(e,r){var a,i,n,s=r;this.pause=function(){t.clearInterval(a),s-=new Date-i},this.stop=function(){t.clearInterval(a),a=null,m.elapsed.textContent="00:00"},n=function(){i=new Date,a=t.setTimeout(function(){s=r,n(),e()},s)},this.resume=n,this.resume()}function n(t){var e=m.stop.getAttribute("data-timer");e&&g[e].timer&&g[e].timer.stop();var r=t.target.getAttribute("data-timer");g[r].load(),m.stop.setAttribute("data-timer",r),m.pause.setAttribute("data-timer",r),m.start.setAttribute("data-timer",r)}function s(t){t.target===this&&n(t)}function o(t,r){var a=e.createElement("li"),i=e.createElement("span");a.classList.add("timers__item"),i.classList.add("timers__remove"),a.setAttribute("data-timer",t),i.setAttribute("data-timer",t),a.textContent=r,i.textContent="Remove",a.appendChild(i),p.appendChild(a),a.addEventListener("click",s,!1),i.addEventListener("click",l,!1)}function l(t){if(t.target===this){var e=this.getAttribute("data-timer"),a=JSON.parse(r.timers);a.splice(e,1),r.setItem("timers",JSON.stringify(a)),g.splice(e,1),this.parentNode.remove()}}var c={createNewTimer:e.querySelector(".controls__view-form"),create:e.querySelector(".controls__create"),addWork:e.querySelector(".partials__add"),save:e.querySelector(".partials__save"),createNew:e.querySelector(".partials__create-new"),load:e.querySelector(".partials__load"),saveLocal:e.querySelector(".partials__local")},u={el:e.querySelector(".controls__form"),partials:e.querySelector(".partials"),partialsForm:e.querySelector(".partials__content"),welcomeBlock:e.querySelector(".controls__name-block")},m={el:e.querySelector(".current"),header:e.querySelector(".current__header"),actionTitle:e.querySelector(".current__action-title"),actionTime:e.querySelector(".current__action-time"),elapsed:e.querySelector(".current__elapsed-time"),remaining:e.querySelector(".current__remaining-time"),circle:e.querySelector(".current__circles-this"),circles:e.querySelector(".current__circles-all"),start:e.querySelector(".current__start"),pause:e.querySelector(".current__pause"),stop:e.querySelector(".current__stop"),audio:e.querySelector(".current__audio")},p=e.querySelector(".timers__list"),d=1,_=1,g=[];a.prototype.add=function(){var t=function(t){var r=e.createElement(t.tag),a=0;for(a;a<t.classNames.length;a++)r.classList.add(t.classNames[a]);return t.name&&r.setAttribute("name",t.name+"_"+d),r.textContent=t.content?t.content:"","work"===t.name?d+=1:_+=1,r},r=function(e){var r=t({tag:"label",classNames:["partials__label"]}),a=t({tag:"span",classNames:["partials__name"],content:e+" (s)"}),i=t({tag:"input",classNames:["partials__input","partials__"+e],name:e});return r.appendChild(a),r.appendChild(i),r},a=r("work"),i=r("rest");u.partialsForm.appendChild(a),u.partialsForm.appendChild(i)},a.prototype.pushToDOM=function(t,e){o(e,t),c.load.setAttribute("data-timer",e),c.saveLocal.setAttribute("data-timer",e)},a.prototype.getHumanReadableTime=function(t,e){var r=10>t?"0"+t:t,a=10>e?"0"+e:e;return r+":"+a},a.prototype.load=function(){var t=this.program.alltime,e=parseInt(t/60),r=t-60*e,a=this.program.workouts[0].value,i=parseInt(a/60),n=a-60*i;m.header.textContent=this.name,m.remaining.textContent=this.getHumanReadableTime(e,r),m.actionTitle.textContent=this.program.workouts[0].title,m.actionTime.textContent=this.getHumanReadableTime(i,n),m.circle.textContent=1,m.circles.textContent=this.program.circles},a.prototype.start=function(){var t=this,e=0,r=1,a=0,n=t.program.alltime,s=t.program.workouts,o=s[a].value;this.timer=new i(function(){var i=parseInt(e/60),l=e-60*parseInt(i),c=parseInt(n/60),u=n-60*parseInt(c),p=parseInt(o/60),d=o-60*parseInt(p);m.elapsed.textContent=t.getHumanReadableTime(i,l),m.remaining.textContent=t.getHumanReadableTime(c,u),m.actionTime.textContent=t.getHumanReadableTime(p,d),0!==n?(4===o?(m.audio.currentTime=0,m.audio.play()):0>=o&&(s[a+1]?a+=1:r<t.program.circles&&(r+=1,a=0,m.circle.textContent=r),o=s[a].value,m.actionTitle.textContent=s[a].title),e+=1,n-=1,o-=1):t.timer.stop()},1e3,m)},c.create.addEventListener("click",function(t){t.preventDefault(),u.welcomeBlock.classList.add("controls_hidden"),u.partials.classList.add("partials_visible");var r=e.querySelector(".partials__timer-user-name");r.textContent=e.querySelector('input[name="timer-name"]').value},!1),c.save.addEventListener("click",function(){var t=e.getElementsByClassName("partials__work"),i=e.getElementsByClassName("partials__rest"),n=new a({name:e.querySelector('input[name="timer-name"]').value});n.program={circles:parseInt(e.querySelector(".partials__circle").value),workouts:[],alltime:""};for(var s=0;s<t.length;s++)n.program.workouts.push({title:"work",value:parseInt(t[s].value)}),n.program.workouts.push({title:"rest",value:parseInt(i[s].value)});n.program.alltime=function(){var t=n.program.workouts,e=t.length,r=0,a=0;for(a;e>a;a++)r+=t[a].value;return r*n.program.circles}(),g.push(n),n.pushToDOM(n.name,g.length-1),c.load.disabled=!1,r&&(c.saveLocal.disabled=!1)},!1),c.addWork.addEventListener("click",function(t){t.preventDefault(),a.prototype.add()},!1),m.start.addEventListener("click",function(){var t=this.getAttribute("data-timer");g[t].start()},!1),m.pause.addEventListener("click",function(){var t=this.getAttribute("data-timer");this.getAttribute("data-pause")?(g[t].timer.resume(),this.setAttribute("data-pause","false"),this.textContent="Пауза",m.start.disabled=!1):(g[t].timer.pause(),this.setAttribute("data-pause","true"),this.textContent="Возобновить",m.start.disabled=!0)},!1),m.stop.addEventListener("click",function(){var t=this.getAttribute("data-timer");g[t].timer.stop()},!1),c.load.addEventListener("click",n,!1),m.stop.addEventListener("click",n,!1),c.saveLocal.addEventListener("click",function(){var t,e=this.getAttribute("data-timer"),a={name:g[e].name,program:g[e].program},i=[];i.push(JSON.stringify(a)),r.timers?(t=JSON.parse(r.timers),t.push(JSON.stringify(a)),r.setItem("timers",JSON.stringify(t))):r.setItem("timers",JSON.stringify(i))},!1),c.createNewTimer.addEventListener("click",function(){u.el.classList.toggle("controls__form_state_hidden")},!1);!function(){if(r&&r.timers){var t=r.timers,e=0;for(t=JSON.parse(t),e;e<t.length;e++){var i=JSON.parse(t[e]);g[g.length]=new a({name:i.name,program:i.program}),o(g.length-1,i.name)}}}()}(window,window.document,window.localStorage);