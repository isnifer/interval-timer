!function(t,e,r){function a(t){this.name=t&&t.name?t.name:"Press",this.program=t&&t.program?t.program:{},this.constructor=constructor?constructor:t.constructor,this.date=function(){var e=new Date,r=["01","02","03","04","05","06","07","08","09","10","11","12"];return t.date?t.date:e.getDate()+"."+r[e.getMonth()]+"."+e.getFullYear()}()}function i(e,r){var a,i,n,s=r;this.pause=function(){t.clearInterval(a),s-=new Date-i},this.stop=function(){t.clearInterval(a),a=null,f.elapsed.textContent="00:00"},n=function(){i=new Date,a=t.setTimeout(function(){s=r,n(),e()},s)},this.resume=n,this.resume()}function n(){h.welcomeBlock.classList.add("controls_hidden"),h.partials.classList.add("partials_visible");var t=e.querySelector(".partials__timer-user-name");t.textContent=e.querySelector('input[name="timer-name"]').value}function s(){var t=e.getElementsByClassName("partials__work"),i=e.getElementsByClassName("partials__rest"),n=new a({name:e.querySelector('input[name="timer-name"]').value});n.program={circles:parseInt(e.querySelector(".partials__circle").value),workouts:[],alltime:""};for(var s=0;s<t.length;s++)n.program.workouts.push({title:"work",value:parseInt(t[s].value)}),n.program.workouts.push({title:"rest",value:parseInt(i[s].value)});n.program.alltime=function(){var t=n.program.workouts,e=t.length,r=0,a=0;for(a;e>a;a++)r+=t[a].value;return r*n.program.circles}(),q.push(n),n.pushToDOM(n.name,q.length-1),v.load.disabled=!1,v.saveLocal.disabled=!r}function o(){var t=this.getAttribute("data-timer");q[t].start()}function l(){var t=this.getAttribute("data-timer");this.getAttribute("data-pause")?(q[t].timer.resume(),this.setAttribute("data-pause","false"),this.textContent="Пауза",f.start.disabled=!1):(q[t].timer.pause(),this.setAttribute("data-pause","true"),this.textContent="Возобновить",f.start.disabled=!0)}function c(){h.el.classList.toggle("controls__form_state_hidden")}function u(){var t=this.getAttribute("data-timer");q[t].timer.stop(),q[t].load()}function m(){var t,e=this.getAttribute("data-timer"),a={name:q[e].name,program:q[e].program},i=[];i.push(JSON.stringify(a)),r.timers?(t=JSON.parse(r.timers),t.push(JSON.stringify(a)),r.setItem("timers",JSON.stringify(t))):r.setItem("timers",JSON.stringify(i))}function d(t){var e=f.stop.getAttribute("data-timer");e&&q[e].timer&&q[e].timer.stop();var r=t.target.getAttribute("data-timer");q[r].load(),f.stop.setAttribute("data-timer",r),f.stop.disabled=!1,f.pause.setAttribute("data-timer",r),f.pause.disabled=!1,f.start.setAttribute("data-timer",r),f.start.disabled=!1}function p(t){t.target===this&&d(t)}function _(t,r){var a=e.createElement("li"),i=e.createElement("span");a.classList.add("timers__item"),i.classList.add("timers__remove"),a.setAttribute("data-timer",t),i.setAttribute("data-timer",t),a.textContent=r,i.textContent="Remove",a.appendChild(i),y.appendChild(a),a.addEventListener("click",p,!1),i.addEventListener("click",g,!1)}function g(t){if(t.target===this){var e=this.getAttribute("data-timer"),a=JSON.parse(r.timers);a.splice(e,1),r.setItem("timers",JSON.stringify(a)),q.splice(e,1),this.parentNode.remove()}}var v={chooseName:e.querySelector(".controls__view-form"),fillFields:e.querySelector(".controls__create"),addWork:e.querySelector(".partials__add"),save:e.querySelector(".partials__save"),createNew:e.querySelector(".partials__create-new"),load:e.querySelector(".partials__load"),saveLocal:e.querySelector(".partials__local")},h={el:e.querySelector(".controls__form"),partials:e.querySelector(".partials"),partialsForm:e.querySelector(".partials__content"),welcomeBlock:e.querySelector(".controls__name-block")},f={el:e.querySelector(".current"),header:e.querySelector(".current__header"),actionTitle:e.querySelector(".current__action-title"),actionTime:e.querySelector(".current__action-time"),elapsed:e.querySelector(".current__elapsed-time"),remaining:e.querySelector(".current__remaining-time"),circle:e.querySelector(".current__circles-this"),circles:e.querySelector(".current__circles-all"),start:e.querySelector(".current__start"),pause:e.querySelector(".current__pause"),stop:e.querySelector(".current__stop"),audio:e.querySelector(".current__audio")},y=e.querySelector(".timers__list"),S=1,b=1,q=[];a.prototype.add=function(){var t=function(t){var r=e.createElement(t.tag),a=0;for(a;a<t.classNames.length;a++)r.classList.add(t.classNames[a]);return t.name&&r.setAttribute("name",t.name+"_"+S),r.textContent=t.content?t.content:"","work"===t.name?S+=1:b+=1,r},r=function(e){var r=t({tag:"label",classNames:["partials__label"]}),a=t({tag:"span",classNames:["partials__name"],content:e+" (s)"}),i=t({tag:"input",classNames:["partials__input","partials__"+e],name:e});return r.appendChild(a),r.appendChild(i),r},a=r("work"),i=r("rest");h.partialsForm.appendChild(a),h.partialsForm.appendChild(i)},a.prototype.pushToDOM=function(t,e){_(e,t),v.load.setAttribute("data-timer",e),v.saveLocal.setAttribute("data-timer",e)},a.prototype.getHumanReadableTime=function(t,e){var r=10>t?"0"+t:t,a=10>e?"0"+e:e;return r+":"+a},a.prototype.load=function(){var t=this.program.alltime,e=parseInt(t/60),r=t-60*e,a=this.program.workouts[0].value,i=parseInt(a/60),n=a-60*i;f.header.textContent=this.name,f.remaining.textContent=this.getHumanReadableTime(e,r),f.actionTitle.textContent=this.program.workouts[0].title,f.actionTime.textContent=this.getHumanReadableTime(i,n),f.circle.textContent=1,f.circles.textContent=this.program.circles},a.prototype.start=function(){var t=this,e=0,r=1,a=0,n=t.program.alltime,s=t.program.workouts,o=s[a].value;this.timer=new i(function(){var i=parseInt(e/60),l=e-60*parseInt(i),c=parseInt(n/60),u=n-60*parseInt(c),m=parseInt(o/60),d=o-60*parseInt(m);f.elapsed.textContent=t.getHumanReadableTime(i,l),f.remaining.textContent=t.getHumanReadableTime(c,u),f.actionTime.textContent=t.getHumanReadableTime(m,d),0!==n?(4===o?(f.audio.currentTime=0,f.audio.play()):0>=o&&(s[a+1]?a+=1:r<t.program.circles&&(r+=1,a=0,f.circle.textContent=r),o=s[a].value,f.actionTitle.textContent=s[a].title),e+=1,n-=1,o-=1):t.timer.stop()},1e3,f)},v.fillFields.addEventListener("click",n,!1),v.save.addEventListener("click",s,!1),v.addWork.addEventListener("click",a.prototype.add,!1),f.start.addEventListener("click",o,!1),f.pause.addEventListener("click",l,!1),f.stop.addEventListener("click",u,!1),v.load.addEventListener("click",d,!1),v.saveLocal.addEventListener("click",m,!1),v.chooseName.addEventListener("click",c,!1);!function(){if(r&&r.timers){var t=r.timers,e=0;for(t=JSON.parse(t),e;e<t.length;e++){var i=JSON.parse(t[e]);q[q.length]=new a({name:i.name,program:i.program}),_(q.length-1,i.name)}}}()}(window,window.document,window.localStorage);